<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>CAVE Query: Proofread Cells – MICrONs Tutorial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-9eb995e8644016eb670a0cb3bf478a26.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="CAVE Query: Proofread Cells – MICrONs Tutorial">
<meta property="og:description" content="">
<meta property="og:site_name" content="MICrONs Tutorial">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">MICrONs Tutorial</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../introduction.html"> 
<span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.microns-explorer.org/"> 
<span class="menu-text">Microns Explorer</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../analysis_gallery/index.html"> 
<span class="menu-text">Analysis Gallery</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../faq.html"> 
<span class="menu-text">FAQ</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://www.nature.com/collections/bdigiaicbd"> 
<span class="menu-text">Nature Publications</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-chat-left-text-fill"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/AllenInstitute/microns_tutorial/discussions">
            Forum
            </a>
          </li>
      </ul>
    </div>
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-1" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-1">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/AllenInstitute/microns_tutorial">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/AllenInstitute/microns_tutorial/issues">
            Report a Bug
            </a>
          </li>
      </ul>
    </div>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../python-tools.html">Python Tools</a></li><li class="breadcrumb-item"><a href="../quickstart_notebooks/03-cave-query-proofread-cells.html">CAVE Query: Proofread Cells</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Background</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../dataset-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dataset Basics</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Versioning and Data Quality</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../proofreading.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Proofreading and Data Quality</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../materialization-version.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Materialization and Versioning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../vortex-overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Virtual Observatory of the Cortex (VORTEX)</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Online Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../neuroglancer-basic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Neuroglancer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../dash-table-viewer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dash Apps: Table Viewer</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../dash-connectivity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Dash Apps: Connectivity Viewer</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="../python-tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python Tools</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quickstart_notebooks/01-caveclient-setup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CAVEclient Setup</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quickstart_notebooks/02-cave-query-cell-types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CAVE Query: Cell Types</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quickstart_notebooks/03-cave-query-proofread-cells.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">CAVE Query: Proofread Cells</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quickstart_notebooks/04-cave-query-synapses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">CAVE Query: Synaptic Connectivity</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quickstart_notebooks/05-cloudvolume-download.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Download Imagery and Segmentation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quickstart_notebooks/06-cloudvolume-download-mesh.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Download Meshes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quickstart_notebooks/07-cave-download-skeleton.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Download Skeletons</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quickstart_notebooks/08-standard-transform.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Standard Transform: Coordinate System</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../quickstart_notebooks/09-nglui-neuroglancer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">NGLui: Neuroglancer States</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Data Inventory</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Release Manifests</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../release_manifests/version-1300.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1300 (Jan 2025)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../release_manifests/version-1181.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1181 (Sep 2024)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../release_manifests/version-1078.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1078 (Jun 2024)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../release_manifests/version-943.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">943 (Jan 2024)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../release_manifests/version-795.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">795 (Aug 2023)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../release_manifests/version-661.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">661 (Jun 2023)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../release_manifests/version-343.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">343 (Feb 2022)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../release_manifests/version-117.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">117 (Jun 2021)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../annotation-tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Annotation Tables</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../static-repositories.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Static Repositories</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#caveclient" id="toc-caveclient" class="nav-link active" data-scroll-target="#caveclient">CAVEclient</a>
  <ul class="collapse">
  <li><a href="#materialization-versions" id="toc-materialization-versions" class="nav-link" data-scroll-target="#materialization-versions">Materialization versions</a></li>
  </ul></li>
  <li><a href="#querying-proofread-neurons" id="toc-querying-proofread-neurons" class="nav-link" data-scroll-target="#querying-proofread-neurons">Querying Proofread neurons</a>
  <ul class="collapse">
  <li><a href="#proofread-neurons" id="toc-proofread-neurons" class="nav-link" data-scroll-target="#proofread-neurons">Proofread neurons</a></li>
  <li><a href="#filtering-queries-by-proofreading-status" id="toc-filtering-queries-by-proofreading-status" class="nav-link" data-scroll-target="#filtering-queries-by-proofreading-status">Filtering Queries by proofreading status</a></li>
  </ul></li>
  <li><a href="#combining-proofread-cells-and-cell-types" id="toc-combining-proofread-cells-and-cell-types" class="nav-link" data-scroll-target="#combining-proofread-cells-and-cell-types">Combining proofread cells and cell types</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.dev/AllenInstitute/microns_tutorial/blob/main/tutorial_book/quickstart_notebooks/03-cave-query-proofread-cells.ipynb" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/AllenInstitute/microns_tutorial/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div><div class="quarto-code-links"><h2>Code Links</h2><ul><li><a href="https://github.com/AllenInstitute/microns_tutorial/tree/main/tutorial_book/quickstart_notebooks"><i class="bi bi-file-code"></i>Download Quickstart Notebooks</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../python-tools.html">Python Tools</a></li><li class="breadcrumb-item"><a href="../quickstart_notebooks/03-cave-query-proofread-cells.html">CAVE Query: Proofread Cells</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">CAVE Query: Proofread Cells</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>The <strong>Connectome Annotation Versioning Engine (CAVE)</strong> is a suite of tools developed at the Allen Institute and Seung Lab to manage large connectomics data.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Initial Setup
</div>
</div>
<div class="callout-body-container callout-body">
<p>Before using any programmatic access to the data, <a href="em_py_01_caveclient_setup.html">you first need to set up your CAVEclient token</a>.</p>
</div>
</div>
<section id="caveclient" class="level2">
<h2 class="anchored" data-anchor-id="caveclient">CAVEclient</h2>
<p>Most programmatic access to the CAVE services occurs through CAVEclient, a Python client to access various types of data from the online services.</p>
<p>Full documentation for CAVEclient <a href="http://caveclient.readthedocs.io">is available here</a>.</p>
<p>To initialize a caveclient, we give it a <strong>datastack</strong>, which is a name that defines a particular combination of imagery, segmentation, and annotation database. For the MICrONs public data, we use the datastack name <code>minnie65_public</code>.</p>
<div id="3ebc5ac7" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> caveclient <span class="im">import</span> CAVEclient</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>datastack_name <span class="op">=</span> <span class="st">'minnie65_public'</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>client <span class="op">=</span> CAVEclient(datastack_name)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Show the description of the datastack</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>client.info.get_datastack_info()[<span class="st">'description'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>'This is the publicly released version of the minnie65 volume and segmentation. '</code></pre>
</div>
</div>
<section id="materialization-versions" class="level3">
<h3 class="anchored" data-anchor-id="materialization-versions">Materialization versions</h3>
<p>Data in CAVE is timestamped and periodically versioned - each (materialization) version corresponds to a specific timestamp. Individual versions are made publicly available. The Materialization client allows one to interact with the materialized annotation tables that were posted to the annotation service. These are called <strong>queries</strong> to the dataset, and available from <code>client.materialize</code>. For more, see the <a href="https://caveconnectome.github.io/CAVEclient/tutorials/materialization/">CAVEclient Documentation</a>.</p>
<p>Periodic updates are made to the public datastack, which will include updates to the available tables. Some cells will have different <code>pt_root_id</code> because they have undergone <a href="../proofreading.html">proofreading</a>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>For analysis consistency, is worth checking the version of the data you are using, and consider specifying the version with <code>client.version = your_version</code></p>
<p>Read more about <a href="..\materialization-version.html#how-to-set-the-version-of-your-analysis">setting the version of your analysis</a></p>
</div>
</div>
<div id="b8e8a165-6cae-44b4-b7c9-b52ae94eec37" class="cell" data-tags="[]" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># see the available materialization versions</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>client.materialize.get_versions()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">
<pre><code>[1300, 1078, 117, 661, 343, 1181, 795, 943]</code></pre>
</div>
</div>
<p>And these are their associated timestamps (all timestamps are in UTC):</p>
<div id="3c9d7b64-56b6-4567-8307-775dcf139ca4" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> version <span class="kw">in</span> client.materialize.get_versions():</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Version </span><span class="sc">{</span>version<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>client<span class="sc">.</span>materialize<span class="sc">.</span>get_timestamp(version)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Version 1300: 2025-01-13 10:10:01.286229+00:00
Version 1078: 2024-06-05 10:10:01.203215+00:00
Version 117: 2021-06-11 08:10:00.215114+00:00
Version 661: 2023-04-06 20:17:09.199182+00:00
Version 343: 2022-02-24 08:10:00.184668+00:00
Version 1181: 2024-09-16 10:10:01.121167+00:00
Version 795: 2023-08-23 08:10:01.404268+00:00
Version 943: 2024-01-22 08:10:01.497934+00:00</code></pre>
</div>
</div>
<div id="a066a177-5d23-4898-9765-4f4e620be719" class="cell" data-tags="[]" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set materialization version, for consistency</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>client.version <span class="op">=</span> <span class="dv">1300</span> <span class="co"># current public as of 1/13/2025</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="querying-proofread-neurons" class="level2">
<h2 class="anchored" data-anchor-id="querying-proofread-neurons">Querying Proofread neurons</h2>
<section id="proofread-neurons" class="level3">
<h3 class="anchored" data-anchor-id="proofread-neurons">Proofread neurons</h3>
<p>Proofreading is necessary to obtain accurate reconstructions of a cell. In the MICrONS dataset, the general rule is that dendrites onto cells with a <em>single</em> cell body are sufficiently proofread to trust synaptic connections onto a cell. Axons on the other hand require so much proofreading that only ~1800 cells have axons such that their outputs should be used for analysis.</p>
<p>Table name: <code>proofreading_status_and_strategy</code></p>
<p>The table <code>proofreading_status_and_strategy</code> describes the status of cells that have undergone manual proofreading.</p>
<p>Because of the inherent difference in the difficulty and time required for different kinds of proofreading, we describe the status of axons and dendrites separately.</p>
<p>Each compartment <code>status</code> may be either:</p>
<ul>
<li><code>FALSE</code>: indicates no comprehensive proofreading has been performed, or is not applicable.<br>
</li>
<li><code>TRUE</code>: indicates that false merges have been comprehensively removed, and the compartment is at least ‘clean’. Consult the <code>strategy</code> column if completeness of the compartment is relevant to your research.</li>
</ul>
<p>An axon or dendrite labeled as <code>status=TRUE</code> can be trusted to be correct, but may not be complete. The degree of completion can be read from the <code>strategy</code> column. For more information, please see <a href="../em_03_proofreading.html">Proofreading and Data Quality</a>; or also the <a href="https://www.microns-explorer.org/manifests/mm3-proofreading">microns-explorer page on proofreading strategies</a>.</p>
<p>The key columns are:</p>
<table class="table-light table-hover caption-top table">
<caption>Proofreading Status Table</caption>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Column</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>id</code></td>
<td style="text-align: left;">Soma ID for the cell</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>pt_position</code> &nbsp;<code>pt_supervoxel_id</code> &nbsp;<code>pt_root_id</code></td>
<td style="text-align: left;">Bound spatial point columns associated with the centroid of the cell nucleus</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>valid_id</code></td>
<td style="text-align: left;">The root id of the neuron when it the proofreading assessment was made. <em>NOTE: if this does not match the <code>pt_root_id</code> then the cell has undergone further changes. This is usually and improvement in proofreading, but proceed with caution.</em></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>status_dendrite</code></td>
<td style="text-align: left;">The status of the dendrite proofreading. May be <code>TRUE</code> or <code>FALSE</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>status_axon</code></td>
<td style="text-align: left;">The status of the axon proofreading. May be <code>TRUE</code> or <code>FALSE</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>strategy_dendrite</code></td>
<td style="text-align: left;">The strategy employed to proofread the dendrite. See strategy table below for details</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>strategy_axon</code></td>
<td style="text-align: left;">The strategy employed to proofread the axon. See strategy table below for details</td>
</tr>
</tbody>
</table>
<p>The specific strategies are as follows (and will update over time):</p>
<section id="proofreading-strategies" class="level4">
<h4 class="anchored" data-anchor-id="proofreading-strategies">Proofreading Strategies</h4>
<table class="table-light table-hover caption-top table">
<caption>Proofreading Strategy Table</caption>
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Strategy</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>none</code></td>
<td style="text-align: left;">No cleaning, and no extension. Indicates an entry in <code>proofreading_status</code> that is <code>FALSE</code> for that compartment</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>dendrite_clean</code></td>
<td style="text-align: left;">The dendrite had incorrectly-merged axon and dendritic segments comprehensively removed, meaning the input synapses are accurate. The dendrite may be incorrectly truncated by segmentation error. Not all dendrite tips have been checked for extension. No comprehensive attempt was made to re-attach spine heads.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>dendrite_extended</code></td>
<td style="text-align: left;">The dendrite had incorrectly-merged axon and dendritic segments comprehensively removed, meaning the input synapses are accurate. Every tip was identified, manually inspected, and extended if possible. No comprehensive attempt was made to re-attach spine heads.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>axon_column_truncated</code></td>
<td style="text-align: left;">AThe axon was extended within the V1 cortical column, with a preference for local connections. In some cases the axon was cut at the column boundary and/or the layer boundary, especially the boundary between layers 2/3 and layer 4. Output synapses represent a sampling of potential partners</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>axon_interareal</code></td>
<td style="text-align: left;">The axon was extended with a preference for branches that projected to other brain areas. Some axon branches were fully extended, but local connections may be incomplete. Output synapses represent a sampling of potential partners.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>axon_partially_extended</code></td>
<td style="text-align: left;">The axon was extended outward from the soma, following each branch to its termination. Output synapses represent a sampling of potential partners.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>axon_fully_extended</code></td>
<td style="text-align: left;">Axon was extended outward from the soma, following each branch to its termination. After initial extension, every endpoint was identified, manually inspected, and extended again if possible. Output synapses represent a largely complete sampling of partners.</td>
</tr>
</tbody>
</table>
<p>This table, <code>proofreading_status_and_strategy</code>, supercedes <code>proofreading_status_public_release</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard query</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>client.materialize.query_table(<span class="st">'proofreading_status_and_strategy'</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Content-aware query</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>client.materialize.tables.proofreading_status_and_strategy(status_axon<span class="op">=</span><span class="st">'t'</span>).query()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here we query and return the table as of version <strong>1300</strong>.</p>
<p>For the commands used for querying tables, see the <a href="02-cave-query-cell-types.html#querying-tables">previous quickstart notebook on CAVE queries</a></p>
<div id="78de0c65-effb-402c-a77b-5adbe426126d" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>proof_all_df <span class="op">=</span> client.materialize.query_table(<span class="st">"proofreading_status_and_strategy"</span>, </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                                              desired_resolution<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>], </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>                                              split_positions<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="b89e1d76-0275-475e-9ddc-04bca7d83043" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>proof_all_df[<span class="st">"strategy_axon"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>strategy_axon
axon_partially_extended    1459
none                        149
axon_interareal             130
axon_fully_extended         127
Name: count, dtype: int64</code></pre>
</div>
</div>
</section>
</section>
<section id="filtering-queries-by-proofreading-status" class="level3">
<h3 class="anchored" data-anchor-id="filtering-queries-by-proofreading-status">Filtering Queries by proofreading status</h3>
<p>We can filter our query to only return rows that match a condition by adding a filter to our query:</p>
<div id="104bac4e-6bc1-4a20-8da5-170fc61eaaa9" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>proof_axon_df <span class="op">=</span> client.materialize.query_table(<span class="st">"proofreading_status_and_strategy"</span>, </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                                               filter_in_dict<span class="op">=</span>{<span class="st">"strategy_axon"</span>: [<span class="st">"axon_partially_extended"</span>, <span class="st">"axon_fully_extended"</span>, <span class="st">"axon_interareal"</span>]}, </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                                               desired_resolution<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>], </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                                               split_positions<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>proof_axon_df.tail()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">created</th>
<th data-quarto-table-cell-role="th">superceded_id</th>
<th data-quarto-table-cell-role="th">valid</th>
<th data-quarto-table-cell-role="th">pt_position_x</th>
<th data-quarto-table-cell-role="th">pt_position_y</th>
<th data-quarto-table-cell-role="th">pt_position_z</th>
<th data-quarto-table-cell-role="th">valid_id</th>
<th data-quarto-table-cell-role="th">status_dendrite</th>
<th data-quarto-table-cell-role="th">status_axon</th>
<th data-quarto-table-cell-role="th">strategy_dendrite</th>
<th data-quarto-table-cell-role="th">strategy_axon</th>
<th data-quarto-table-cell-role="th">pt_supervoxel_id</th>
<th data-quarto-table-cell-role="th">pt_root_id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1711</td>
<td>3062</td>
<td>2025-01-12 03:00:00.936352+00:00</td>
<td>NaN</td>
<td>t</td>
<td>705920.0</td>
<td>705664.0</td>
<td>903960.0</td>
<td>864691135867413893</td>
<td>t</td>
<td>t</td>
<td>dendrite_clean</td>
<td>axon_partially_extended</td>
<td>89031992993240476</td>
<td>864691135867413893</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1712</td>
<td>3063</td>
<td>2025-01-12 03:00:00.954516+00:00</td>
<td>NaN</td>
<td>t</td>
<td>684800.0</td>
<td>659968.0</td>
<td>891160.0</td>
<td>864691135276601317</td>
<td>t</td>
<td>t</td>
<td>dendrite_clean</td>
<td>axon_partially_extended</td>
<td>88326724936602021</td>
<td>864691135276601317</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1713</td>
<td>3064</td>
<td>2025-01-12 03:00:00.972946+00:00</td>
<td>NaN</td>
<td>t</td>
<td>742400.0</td>
<td>667008.0</td>
<td>830000.0</td>
<td>864691135742247787</td>
<td>t</td>
<td>t</td>
<td>dendrite_clean</td>
<td>axon_partially_extended</td>
<td>90297324450184090</td>
<td>864691135742247787</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1714</td>
<td>3065</td>
<td>2025-01-12 03:00:00.992770+00:00</td>
<td>NaN</td>
<td>t</td>
<td>689472.0</td>
<td>839744.0</td>
<td>904880.0</td>
<td>864691135591960075</td>
<td>t</td>
<td>t</td>
<td>dendrite_extended</td>
<td>axon_fully_extended</td>
<td>88473509805848805</td>
<td>864691135591960075</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1715</td>
<td>3066</td>
<td>2025-01-12 03:00:01.012280+00:00</td>
<td>NaN</td>
<td>t</td>
<td>746880.0</td>
<td>612224.0</td>
<td>891720.0</td>
<td>864691135939049988</td>
<td>t</td>
<td>t</td>
<td>dendrite_clean</td>
<td>axon_partially_extended</td>
<td>90436206713993499</td>
<td>864691135939049988</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>A more unified filter interface is available through a “table manager” interface.</p>
<p>Rather than passing a table name to the <code>query_table</code> function, <code>client.materialize.tables</code> has a subproperty for each table in the database that can be used to filter that table.</p>
<p>The general pattern for usage is</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>client.materialize.tables.{table_name}({<span class="bu">filter</span> options}).query({<span class="bu">format</span> <span class="kw">and</span> timestamp options})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>where <code>{table_name}</code> is the name of the table you want to filter, <code>{filter options}</code> is a collection of arguments for filtering the query, and <code>{format and timestamp options}</code> are those parameters controlling the format and timestamp of the query.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use of this functionality will show a brief warning that the interface is experimental. This is because the interface is still being developed and may change in the near future in response to user feedback.</p>
</div>
</div>
<p>With this, we can easily query all proofread cells with proofread axons:</p>
<div id="e07c63af-3c81-487b-90f3-ca3b4b220bf8" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>proof_axon_df <span class="op">=</span> client.materialize.tables.proofreading_status_and_strategy(strategy_axon<span class="op">=</span>[<span class="st">"axon_partially_extended"</span>, <span class="st">"axon_fully_extended"</span>, <span class="st">"axon_interareal"</span>]).query(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    select_columns<span class="op">=</span>[<span class="st">'pt_root_id'</span>,<span class="st">'status_axon'</span>,<span class="st">'status_dendrite'</span>,<span class="st">'strategy_axon'</span>,<span class="st">'strategy_dendrite'</span>],</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>proof_axon_df.tail()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pt_root_id</th>
<th data-quarto-table-cell-role="th">status_axon</th>
<th data-quarto-table-cell-role="th">status_dendrite</th>
<th data-quarto-table-cell-role="th">strategy_axon</th>
<th data-quarto-table-cell-role="th">strategy_dendrite</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1711</td>
<td>864691135867413893</td>
<td>t</td>
<td>t</td>
<td>axon_partially_extended</td>
<td>dendrite_clean</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1712</td>
<td>864691135276601317</td>
<td>t</td>
<td>t</td>
<td>axon_partially_extended</td>
<td>dendrite_clean</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1713</td>
<td>864691135742247787</td>
<td>t</td>
<td>t</td>
<td>axon_partially_extended</td>
<td>dendrite_clean</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1714</td>
<td>864691135591960075</td>
<td>t</td>
<td>t</td>
<td>axon_fully_extended</td>
<td>dendrite_extended</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1715</td>
<td>864691135939049988</td>
<td>t</td>
<td>t</td>
<td>axon_partially_extended</td>
<td>dendrite_clean</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
<section id="combining-proofread-cells-and-cell-types" class="level2">
<h2 class="anchored" data-anchor-id="combining-proofread-cells-and-cell-types">Combining proofread cells and cell types</h2>
<p>For analysis, often you are interested in neurons that are at the intersection of two or more groups. For example: <strong>proofread cells</strong> that are also <strong>layer 2/3 pyramidal cells</strong>. The general workflow for this type of analysis is to:</p>
<ol type="1">
<li>Query from one table, for example the <code>proofreading_status_and_strategy</code> table</li>
<li>Query from another table, for example the <code>aibs_metamodel_celltypes_v661</code></li>
<li>Merge the two tables on the shared index, in this case <code>pt_root_id</code></li>
</ol>
<p>We covered <a href="02-cave-query-cell-types.html">querying cell types in the previous quickstart notebook</a>. Now lets put that together with the proofreading query:</p>
<div id="367285c0-ac12-4091-b279-bdaa2bb1903e" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Query proofread cells with status_axon==True</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>proof_df <span class="op">=</span> client.materialize.tables.proofreading_status_and_strategy(status_axon<span class="op">=</span><span class="st">"t"</span>).query(</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    select_columns<span class="op">=</span>[<span class="st">'pt_root_id'</span>,<span class="st">'status_axon'</span>,<span class="st">'status_dendrite'</span>,<span class="st">'strategy_axon'</span>,<span class="st">'strategy_dendrite'</span>],</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Query cell types</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>cell_type_df <span class="op">=</span> client.materialize.tables.aibs_metamodel_celltypes_v661().query(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    select_columns <span class="op">=</span> {<span class="st">'nucleus_detection_v0'</span>: [<span class="st">'pt_root_id'</span>, <span class="st">'id'</span>],</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'aibs_metamodel_celltypes_v661'</span>: [<span class="st">'classification_system'</span>,<span class="st">'cell_type'</span>],</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>                     },</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note the ‘select_columns’ argument differs between the two tables. Thay is because the second table, <code>aibs_metamodel_celltypes_v661</code> is itself a reference on <code>nucleus_detection_v0</code>. That means the <code>id</code> column returned here is the same as the <strong>nucleus id</strong> of the cell. This is handy for referencing the same cell across materialization versions as the <strong>nucleus id</strong> does not change, whereas the <code>pt_root_id</code> will change with proofreading.</p>
</div>
</div>
<p>Now we can merge the two tables together on the shared index!</p>
<p>But it is worth checking if there are duplicates in either of the tables. How you handle duplicates will depend on your question, and the table you are using. Here we might see duplicates from multi-soma merges in the cell type table</p>
<div id="7f6bfa07-2f34-4b96-bd6e-70a8d8fbba94" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>cell_type_df.value_counts(<span class="st">'pt_root_id'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>pt_root_id
864691134966128927    350
0                     175
864691137020183406    102
864691136974041116     60
864691135303545767     43
                     ... 
864691135571655661      1
864691135571652845      1
864691135571650797      1
864691135571649317      1
864691135777169085      1
Name: count, Length: 91423, dtype: int64</code></pre>
</div>
</div>
<p>For analytical simplicity, we will drop any multi-soma objects. We will also rename the <code>id</code> column for clarity</p>
<div id="ebae041b-af55-436f-af2f-93cfb018bd5a" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop duplicate pt_root_id and rename the nucleus_id</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>cell_type_df <span class="op">=</span> (cell_type_df</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                .drop_duplicates(<span class="st">'pt_root_id'</span>, keep<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                .rename(columns<span class="op">=</span>{<span class="st">'id'</span>: <span class="st">'nucleus_id'</span>})</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                        </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>cell_type_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pt_root_id</th>
<th data-quarto-table-cell-role="th">nucleus_id</th>
<th data-quarto-table-cell-role="th">classification_system</th>
<th data-quarto-table-cell-role="th">cell_type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>864691136274724621</td>
<td>336365</td>
<td>excitatory_neuron</td>
<td>5P-IT</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>864691135489403194</td>
<td>110648</td>
<td>excitatory_neuron</td>
<td>23P</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>864691136147292311</td>
<td>112071</td>
<td>excitatory_neuron</td>
<td>23P</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>864691136050858227</td>
<td>197927</td>
<td>nonneuron</td>
<td>oligo</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>864691135809440972</td>
<td>198087</td>
<td>nonneuron</td>
<td>astrocyte</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now we can merge the two tables with <code>pandas.merge</code>, on index <code>pt_root_id</code>. We will keep the inner join of the two tables: cells that 1) are proofread, and 2) have a cell type</p>
<div id="6a4dc552-8125-4b92-ab5d-84a33439c286" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>proof_cell_type_df <span class="op">=</span> pd.merge(proof_df, cell_type_df, on<span class="op">=</span><span class="st">'pt_root_id'</span>, how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>proof_cell_type_df.tail()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pt_root_id</th>
<th data-quarto-table-cell-role="th">status_axon</th>
<th data-quarto-table-cell-role="th">status_dendrite</th>
<th data-quarto-table-cell-role="th">strategy_axon</th>
<th data-quarto-table-cell-role="th">strategy_dendrite</th>
<th data-quarto-table-cell-role="th">nucleus_id</th>
<th data-quarto-table-cell-role="th">classification_system</th>
<th data-quarto-table-cell-role="th">cell_type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">1700</td>
<td>864691135867413893</td>
<td>t</td>
<td>t</td>
<td>axon_partially_extended</td>
<td>dendrite_clean</td>
<td>263073</td>
<td>excitatory_neuron</td>
<td>5P-IT</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1701</td>
<td>864691135276601317</td>
<td>t</td>
<td>t</td>
<td>axon_partially_extended</td>
<td>dendrite_clean</td>
<td>262889</td>
<td>excitatory_neuron</td>
<td>4P</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1702</td>
<td>864691135742247787</td>
<td>t</td>
<td>t</td>
<td>axon_partially_extended</td>
<td>dendrite_clean</td>
<td>298800</td>
<td>excitatory_neuron</td>
<td>4P</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1703</td>
<td>864691135591960075</td>
<td>t</td>
<td>t</td>
<td>axon_fully_extended</td>
<td>dendrite_extended</td>
<td>269591</td>
<td>excitatory_neuron</td>
<td>5P-IT</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">1704</td>
<td>864691135939049988</td>
<td>t</td>
<td>t</td>
<td>axon_partially_extended</td>
<td>dendrite_clean</td>
<td>296761</td>
<td>excitatory_neuron</td>
<td>4P</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>And we have the list of all proofread cells, by their cell type!</p>
<p>We can do this same kind of query more simply by: querying the second table by BOTH the root ids of interest and the cell type of interest. If we wanted only the <strong>proofread 23P cells</strong>, we could do:</p>
<div id="3f487eb4-87b8-483f-9d90-0c26fd589fb7" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Query the proofread 23P cells, and merge the proofreading status</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>proof_23p_df <span class="op">=</span> (client.materialize.tables.aibs_metamodel_celltypes_v661(pt_root_id<span class="op">=</span>proof_df.pt_root_id, cell_type<span class="op">=</span><span class="st">'23P'</span>).query(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    select_columns <span class="op">=</span> {<span class="st">'nucleus_detection_v0'</span>: [<span class="st">'pt_root_id'</span>, <span class="st">'id'</span>],</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                      <span class="st">'aibs_metamodel_celltypes_v661'</span>: [<span class="st">'classification_system'</span>,<span class="st">'cell_type'</span>],</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                     },  )</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                .rename(columns<span class="op">=</span>{<span class="st">'id'</span>: <span class="st">'nucleus_id'</span>})</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                .merge(proof_df, on<span class="op">=</span><span class="st">'pt_root_id'</span>, how<span class="op">=</span><span class="st">'inner'</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>proof_23p_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">pt_root_id</th>
<th data-quarto-table-cell-role="th">nucleus_id</th>
<th data-quarto-table-cell-role="th">classification_system</th>
<th data-quarto-table-cell-role="th">cell_type</th>
<th data-quarto-table-cell-role="th">status_axon</th>
<th data-quarto-table-cell-role="th">status_dendrite</th>
<th data-quarto-table-cell-role="th">strategy_axon</th>
<th data-quarto-table-cell-role="th">strategy_dendrite</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>864691135473477426</td>
<td>258375</td>
<td>excitatory_neuron</td>
<td>23P</td>
<td>t</td>
<td>t</td>
<td>axon_partially_extended</td>
<td>dendrite_clean</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>864691135257669039</td>
<td>258377</td>
<td>excitatory_neuron</td>
<td>23P</td>
<td>t</td>
<td>t</td>
<td>axon_partially_extended</td>
<td>dendrite_clean</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>864691135763593014</td>
<td>258403</td>
<td>excitatory_neuron</td>
<td>23P</td>
<td>t</td>
<td>t</td>
<td>axon_partially_extended</td>
<td>dendrite_clean</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>864691135763433270</td>
<td>258225</td>
<td>excitatory_neuron</td>
<td>23P</td>
<td>t</td>
<td>t</td>
<td>axon_partially_extended</td>
<td>dendrite_clean</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>864691135645874159</td>
<td>292833</td>
<td>excitatory_neuron</td>
<td>23P</td>
<td>t</td>
<td>t</td>
<td>axon_partially_extended</td>
<td>dendrite_clean</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>


</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/tutorial\.microns-explorer\.org");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Contributions by: Bethanny Danskin, Ben Pedigo, Casey Schneider-Mizell, Forrest Collman, Leila Elabbady, Sven Dorkenwald</p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.dev/AllenInstitute/microns_tutorial/blob/main/tutorial_book/quickstart_notebooks/03-cave-query-proofread-cells.ipynb" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/AllenInstitute/microns_tutorial/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>